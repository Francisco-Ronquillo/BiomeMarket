{% load static %}
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiomeMarket</title>
    <link rel="stylesheet" href="{% static 'CSS/site.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/home.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navegaci√≥n -->
    <nav class="navbar">
        <div class="container">
            <div class="logo">
                <img src="{% static 'img/logo.png' %}" alt="Mi imagen">
            </div>
            <ul class="nav-links">
                <li><a href="#productos">Productos</a></li>
                <li><a href="#categorias">Categor√≠as</a></li>
            </ul>
            <div class="nav-icons">
                <a href="{% url 'productos:list_product' %}" class="icon">üîç</a>
                <a href="{% url 'productos:carrito' %}" class="icon">üõí
                    <span class="cart-count">{{ carrito.total_items|default:0 }}</span>
                </a>

                {% if usuario_autenticado %}
            <!-- Mostrar cuando est√° autenticado -->
                    <span class="user-greeting">{{ usuario.nombre }}</span>
                    <a href="{% url 'productos:mis_compras' %}" class="btn-login" style="margin-right:8px;">Mis Compras</a>
                    <a href="{% url 'accounts:logout' %}" class="btn-login">Cerrar Sesi√≥n</a>
                {% else %}
                <!-- Mostrar cuando NO est√° autenticado -->
                    <a href="{% url 'accounts:signin' %}" class="btn-login">Iniciar Sesi√≥n</a>
                    <a href="{% url 'accounts:signup' %}" class="btn-login">Registrarse</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
    <div class="hero-background"></div>  <!-- Capa de overlay -->
    <div class="hero-content">
        <h1>Productos Agr√≠colas Frescos<br>Directo del Campo</h1>
        <p>Conectamos productores locales con tu mesa</p>
    </div>
</section>
<section class="categorias" id="categorias">
    <div class="container">
        <h2>Categor√≠as Principales</h2>
        <div class="categoria-grid">
            {% for categoria in categorias %}
                <div class="categoria-card" onclick="goToCategoria('{{ categoria.tipo }}')" style="cursor: pointer;">
                    {% if categoria.imagen %}
                        <img src="{{ categoria.imagen.url }}" alt="{{ categoria.nombre }}">
                    {% else %}
                        <img src="{% static 'img/logo.png' %}" alt="{{ categoria.nombre }}">  <!-- Imagen por defecto si no hay -->
                    {% endif %}
                    <h3>{{ categoria.nombre }}</h3>
                    <p>{{ categoria.descripcion|truncatewords:10 }}</p>  <!-- Opcional: muestra una descripci√≥n corta -->
                    <!-- Indicador visual de enlace (opcional) -->
                    <small class="categoria-link">Ver productos</small>
                </div>
            {% empty %}
                <div class="no-categorias">
                    <p>No hay categor√≠as disponibles.</p>
                </div>
            {% endfor %}
        </div>
    </div>
</section>

    <!-- Productos Destacados -->
    <section class="productos" id="productos">
        <div class="container">
            <h2>Productos Destacados</h2>
            <div class="featured-carousel">
                <div class="producto-grid" role="list">
                {% for producto in productos_destacados %}
                <div class="producto-card" role="listitem">
                    {% if producto.peso %}
                        <div class="badge">Por peso</div>
                    {% endif %}
                    {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}">
                    {% else %}
                        <img src="{% static 'img/logo.png' %}" alt="{{ producto.nombre }}">
                    {% endif %}
                    <h3>{{ producto.nombre }}</h3>
                    <div class="rating">‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    <p class="price">${{ producto.precio }} {% if producto.peso %}/kg{% endif %}</p>
                    <div class="vendidos">Vendidos: {{ producto.total_vendido|default:0 }}</div>
                    <a class="btn-add-cart" href="{% url 'productos:detalle_producto' producto.id %}">Ver producto</a>
                </div>
                {% empty %}
                <div class="no-destacados">
                    <p>No hay productos destacados todav√≠a.</p>
                </div>
                {% endfor %}
                </div>
            </div>
        </div>
    </section>

    <!-- Beneficios -->
    <section class="beneficios">
        <div class="container">
            <div class="beneficio-grid">
                <div class="beneficio-item">
                    <div class="icon">üå±</div>
                    <h3>Directo del Productor</h3>
                    <p>Sin intermediarios, apoyando a agricultores locales</p>
                </div>
                <div class="beneficio-item">
                    <div class="icon">‚úÖ</div>
                    <h3>Productos Frescos</h3>
                    <p>Calidad garantizada y m√°xima frescura</p>
                </div>
                <div class="beneficio-item">
                    <div class="icon">üöö</div>
                    <h3>Env√≠o a Domicilio</h3>
                    <p>Entrega r√°pida y segura en tu hogar</p>
                </div>
                <div class="beneficio-item">
                    <div class="icon">üèÜ</div>
                    <h3>Certificaciones</h3>
                    <p>Productos con certificaci√≥n org√°nica</p>
                </div>
            </div>
        </div>
    </section>

    <!-- C√≥mo Funciona -->
    <section class="como-funciona">
        <div class="container">
            <h2>¬øC√≥mo Funciona?</h2>
            <div class="pasos-grid">
                <div class="paso">
                    <div class="numero">1</div>
                    <h3>Explora</h3>
                    <p>Navega por nuestro cat√°logo de productos frescos</p>
                </div>
                <div class="paso">
                    <div class="numero">2</div>
                    <h3>Selecciona</h3>
                    <p>Agrega tus productos favoritos al carrito</p>
                </div>
                <div class="paso">
                    <div class="numero">3</div>
                    <h3>Compra</h3>
                    <p>Realiza tu pedido de forma segura</p>
                </div>
                <div class="paso">
                    <div class="numero">4</div>
                    <h3>Recibe</h3>
                    <p>Disfruta de productos frescos en tu puerta</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonios -->
    <section class="testimonios">
        <div class="container">
            <h2>Lo Que Dicen Nuestros Clientes</h2>
            <div class="testimonio-grid">
                <div class="testimonio-card">
                    <p>"Excelente calidad y frescura. Los productos llegan directamente del campo."</p>
                    <div class="cliente">
                        <strong>Mar√≠a Gonz√°lez</strong>
                        <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                    </div>
                </div>
                <div class="testimonio-card">
                    <p>"Me encanta poder apoyar a los productores locales. Productos de primera."</p>
                    <div class="cliente">
                        <strong>Carlos P√©rez</strong>
                        <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                    </div>
                </div>
                <div class="testimonio-card">
                    <p>"La mejor plataforma para comprar productos agr√≠colas frescos y org√°nicos."</p>
                    <div class="cliente">
                        <strong>Ana Rodr√≠guez</strong>
                        <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
<script>
function goToCategoria(tipoCategoria) {
    // Redirige al listado con filtro pre-seleccionado
    const url = `/listado_producto/?categoria=${encodeURIComponent(tipoCategoria)}`;
    console.log('Navegando a categor√≠a:', tipoCategoria, 'URL:', url);
    window.location.href = url;
}
</script>
<!-- Chatbot widget -->
<div id="bm-chatbot-root"></div>
{{ bm_user_data|json_script:"bm_user_data" }}
<script>
    // Carga segura del JSON generado por json_script
    try {
        window.BM_USER = JSON.parse(document.getElementById('bm_user_data').textContent || '{}');
    } catch (e) {
        window.BM_USER = { authenticated: false, name: '' };
    }
</script>
<script src="{% static 'JS/chatbot.js' %}"></script>
</body>
</html>
